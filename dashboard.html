<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventario TI - Domino's Pizza (v96.0 Platinum UI)</title>

    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        :root {
            /* --- COLORES CORPORATIVOS DOMINO'S --- */
            --dominos-blue-dark: #006491;
            --dominos-blue-light: #0088cc; /* Para el degradado */
            --dominos-red: #e31837;
            --bg-color: #f4f7f6;
            --text-color: #333;
            --sidebar-width: 260px;
            --sidebar-collapsed-width: 70px;
            --header-height: 60px;
            --card-shadow: 0 4px 6px rgba(0,0,0,0.05);
            --transition-speed: 0.3s;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Open Sans', sans-serif; }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- 1. SIDEBAR RETRÁCTIL (NUEVO) --- */
        .sidebar {
            width: var(--sidebar-width);
            background-color: #fff;
            height: 100%;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e0e0e0;
            transition: width var(--transition-speed) ease;
            z-index: 100;
            position: relative;
        }

        .sidebar.collapsed { width: var(--sidebar-collapsed-width); }

        .sidebar-header {
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid #f0f0f0;
            overflow: hidden;
        }

        .brand-logo {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--dominos-blue-dark);
            display: flex;
            align-items: center;
            white-space: nowrap;
        }

        .brand-logo i {
            color: var(--dominos-red);
            font-size: 1.5rem;
            min-width: 40px;
            text-align: center;
        }

        .brand-text { margin-left: 5px; transition: opacity 0.2s; }
        .sidebar.collapsed .brand-text { opacity: 0; display: none; }

        .sidebar-menu { list-style: none; padding-top: 20px; flex-grow: 1; }
        
        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            text-decoration: none;
            color: #555;
            transition: all 0.2s;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: #f0f4f8;
            color: var(--dominos-blue-dark);
            border-right: 4px solid var(--dominos-blue-dark);
        }

        .sidebar-menu a i {
            min-width: 30px;
            font-size: 1.1rem;
            text-align: center;
            margin-right: 10px;
        }

        .sidebar.collapsed .sidebar-menu a { justify-content: center; padding: 15px 0; }
        .sidebar.collapsed .sidebar-menu a i { margin-right: 0; }
        .sidebar.collapsed .menu-text { display: none; }

        /* --- 2. HEADER CON DEGRADADO (NUEVO) --- */
        .main-content {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            width: calc(100% - var(--sidebar-width));
            transition: width var(--transition-speed) ease;
        }

        .sidebar.collapsed + .main-content { width: calc(100% - var(--sidebar-collapsed-width)); }

        header {
            height: var(--header-height);
            background: linear-gradient(to right, var(--dominos-blue-dark), var(--dominos-blue-light));
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .header-left { display: flex; align-items: center; gap: 15px; }
        
        .toggle-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
        }

        .user-profile { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; }
        .user-avatar {
            width: 35px; height: 35px;
            background-color: rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
        }

        /* --- 3. CONTENIDO PRINCIPAL (v95.0 LOGIC) --- */
        .content-area {
            padding: 20px;
            overflow-y: auto;
            height: calc(100vh - var(--header-height));
        }

        /* KPIs */
        .kpi-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .kpi-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            border-left: 4px solid var(--dominos-blue-dark);
            transition: transform 0.2s;
        }
        .kpi-card:hover { transform: translateY(-3px); }
        .kpi-title { font-size: 0.9rem; color: #666; margin-bottom: 5px; }
        .kpi-value { font-size: 1.8rem; font-weight: bold; color: var(--dominos-blue-dark); }
        .kpi-icon { float: right; font-size: 1.5rem; opacity: 0.2; }

        /* Toolbar & Table */
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
        }

        .search-box {
            position: relative;
            width: 300px;
        }
        .search-box input {
            width: 100%;
            padding: 10px 10px 10px 35px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .search-box i {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #aaa;
        }

        .action-buttons button {
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-left: 10px;
            color: white;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .btn-add { background-color: var(--dominos-blue-dark); }
        .btn-export { background-color: #217346; /* Excel Green */ }
        .btn-filter { background-color: #6c757d; position: relative; }
        
        .badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--dominos-red);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 50%;
            display: none; /* Oculto por defecto */
        }

        /* Tabla */
        .table-container {
            background: white;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            overflow: hidden;
        }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background-color: #f8f9fa; color: #555; font-weight: 600; }
        tbody tr:hover { background-color: #f1f7fb; }

        .status-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .status-asignado { background-color: #e3f2fd; color: #1565c0; }
        .status-stock { background-color: #e8f5e9; color: #2e7d32; }
        .status-mantenimiento { background-color: #fff3e0; color: #ef6c00; }
        .status-baja { background-color: #ffebee; color: #c62828; }

        /* Acciones en tabla */
        .btn-icon {
            background: none; border: none; cursor: pointer; font-size: 1rem; margin-right: 8px;
            transition: transform 0.2s;
        }
        .btn-icon:hover { transform: scale(1.2); }
        .btn-edit { color: var(--dominos-blue-dark); }
        .btn-delete { color: var(--dominos-red); }

        /* --- MODAL (Estilo v95) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000;
        }
        .modal {
            background: white; width: 500px; padding: 25px; border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); animation: fadeIn 0.3s;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        
        .modal-header { display: flex; justify-content: space-between; margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: 600; color: #555; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
    </style>
</head>
<body>

    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="brand-logo">
                <i class="fa-solid fa-pizza-slice"></i>
                <span class="brand-text">Domino's TI</span>
            </div>
        </div>
        <ul class="sidebar-menu">
            <li><a href="#" class="active"><i class="fa-solid fa-chart-line"></i><span class="menu-text">Dashboard</span></a></li>
            <li><a href="#"><i class="fa-solid fa-box-open"></i><span class="menu-text">Inventario</span></a></li>
            <li><a href="#"><i class="fa-solid fa-users"></i><span class="menu-text">Asignaciones</span></a></li>
            <li><a href="#"><i class="fa-solid fa-file-invoice"></i><span class="menu-text">Reportes</span></a></li>
            <li style="margin-top: auto; border-top: 1px solid #eee;">
                <a href="#" onclick="logout()" style="color: #d9534f;">
                    <i class="fa-solid fa-right-from-bracket"></i><span class="menu-text">Cerrar Sesión</span>
                </a>
            </li>
        </ul>
    </nav>

    <main class="main-content">
        <header>
            <div class="header-left">
                <button class="toggle-btn" id="sidebarToggle"><i class="fa-solid fa-bars"></i></button>
                <span class="header-title">DOMINO'S BACKOFFICE</span>
            </div>
            <div class="user-profile">
                <span>Admin: Emilio Droguett</span>
                <div class="user-avatar"><i class="fa-solid fa-user"></i></div>
            </div>
        </header>

        <div class="content-area">
            <div class="kpi-container">
                <div class="kpi-card">
                    <div class="kpi-title">Total Activos</div>
                    <div class="kpi-value" id="kpi-total">0</div>
                    <i class="fa-solid fa-server kpi-icon"></i>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title">En Stock</div>
                    <div class="kpi-value" id="kpi-stock" style="color: #2e7d32;">0</div>
                    <i class="fa-solid fa-boxes-stacked kpi-icon"></i>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title">Asignados</div>
                    <div class="kpi-value" id="kpi-assigned" style="color: #1565c0;">0</div>
                    <i class="fa-solid fa-user-check kpi-icon"></i>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title">Mantenimiento</div>
                    <div class="kpi-value" id="kpi-maintenance" style="color: #ef6c00;">0</div>
                    <i class="fa-solid fa-screwdriver-wrench kpi-icon"></i>
                </div>
            </div>

            <div class="toolbar">
                <div class="search-box">
                    <i class="fa-solid fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Buscar por serie, modelo o usuario...">
                </div>
                <div class="action-buttons">
                    <button class="btn-filter" onclick="toggleFilters()">
                        <i class="fa-solid fa-filter"></i> Filtros <span class="badge" id="filterBadge">0</span>
                    </button>
                    <button class="btn-export" onclick="exportToExcel()">
                        <i class="fa-solid fa-file-excel"></i> Exportar
                    </button>
                    <button class="btn-add" onclick="openModal()">
                        <i class="fa-solid fa-plus"></i> Nuevo Equipo
                    </button>
                </div>
            </div>

            <div class="table-container">
                <table id="inventoryTable">
                    <thead>
                        <tr>
                            <th>Tipo</th>
                            <th>Marca/Modelo</th>
                            <th>Serie/IMEI</th>
                            <th>Estado</th>
                            <th>Asignado A</th>
                            <th>Ubicación</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <tr><td colspan="7" style="text-align:center;">Cargando...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="itemModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">Nuevo Equipo</h3>
                <button onclick="closeModal()" style="background:none; border:none; cursor:pointer; font-size:1.2rem;">&times;</button>
            </div>
            <form id="inventoryForm">
                <input type="hidden" id="itemId">
                <div class="form-group">
                    <label>Tipo de Equipo</label>
                    <select id="itemType" required>
                        <option value="Laptop">Laptop</option>
                        <option value="Desktop">Desktop</option>
                        <option value="Monitor">Monitor</option>
                        <option value="Celular">Celular</option>
                        <option value="Impresora">Impresora</option>
                        <option value="POS">POS</option>
                    </select>
                </div>
                <div class="form-group" style="display:flex; gap:10px;">
                    <div style="flex:1;">
                        <label>Marca</label>
                        <input type="text" id="itemBrand" required>
                    </div>
                    <div style="flex:1;">
                        <label>Modelo</label>
                        <input type="text" id="itemModel" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>Número de Serie / IMEI</label>
                    <input type="text" id="itemSerial" required>
                </div>
                <div class="form-group">
                    <label>Estado</label>
                    <select id="itemStatus">
                        <option value="Stock">En Stock</option>
                        <option value="Asignado">Asignado</option>
                        <option value="Mantenimiento">Mantenimiento</option>
                        <option value="Baja">Baja</option>
                    </select>
                </div>
                <div id="assignmentFields" style="display:none; background:#f9f9f9; padding:10px; border-radius:4px; margin-bottom:15px;">
                    <div class="form-group">
                        <label>Asignado a (Nombre)</label>
                        <input type="text" id="assignedTo">
                    </div>
                    <div class="form-group">
                        <label>Ubicación / Tienda</label>
                        <input type="text" id="location" placeholder="Ej: Santiago Centro">
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" onclick="closeModal()" style="padding:10px; border:none; cursor:pointer;">Cancelar</button>
                    <button type="submit" class="btn-add">Guardar</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- 1. CONFIGURACIÓN SUPABASE ---
        // IMPORTANTE: Pon tus credenciales reales aquí abajo
        const SUPABASE_URL = 'https://ivjwxvhixrskraepqzse.supabase.co'; 
        const SUPABASE_KEY = 'AeyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml2and4dmhpeHJza3JhZXBxenNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5MjgxNTgsImV4cCI6MjA4NDUwNDE1OH0.QzgNSwqf6VTXZjGMXOAfUnjW4f1mJcRqECxxNnLZc-o'; 
        
        // Inicialización segura
        let supabase;
        let isDemoMode = false;

        try {
            if (!SUPABASE_URL || SUPABASE_URL.includes('TU_SUPABASE_URL') || !SUPABASE_KEY) {
                console.warn("⚠️ ALERTA: Faltan credenciales. Activando MODO DEMO.");
                isDemoMode = true;
            } else {
                supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            }
        } catch (err) {
            console.error("Error iniciando Supabase:", err);
            isDemoMode = true;
        }

        // --- 2. LÓGICA DE UI (Sidebar & Header) ---
        const sidebar = document.getElementById('sidebar');
        const toggleBtn = document.getElementById('sidebarToggle');
        
        if(toggleBtn) {
            toggleBtn.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
            });
        }

        // --- 3. LÓGICA DE NEGOCIO ---
        let inventoryData = [];

        document.addEventListener('DOMContentLoaded', () => {
            fetchInventory();
        });

        async function fetchInventory() {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">Cargando datos...</td></tr>';

            try {
                if (!isDemoMode && supabase) {
                    const { data, error } = await supabase
                        .from('inventory')
                        .select('*')
                        .order('created_at', { ascending: false });

                    if (error) throw error;
                    inventoryData = data || [];
                } else {
                    // DATOS DE PRUEBA (Para que no se vea vacío si faltan credenciales)
                    console.log("Cargando datos DEMO...");
                    inventoryData = [
                        { id: 1, type: 'Laptop', brand: 'Dell', model: 'Latitude 3420', serial: '8H2K92', status: 'Asignado', assigned_to: 'Emilio Droguett', location: 'Casa Matriz' },
                        { id: 2, type: 'Celular', brand: 'Samsung', model: 'A54', serial: 'IMEI39201', status: 'Stock', assigned_to: null, location: 'Bodega TI' },
                        { id: 3, type: 'POS', brand: 'Oracle', model: 'Micros', serial: 'POS-001', status: 'Mantenimiento', assigned_to: null, location: 'Tienda 101' }
                    ];
                }

                renderTable(inventoryData);
                updateKPIs(inventoryData);

            } catch (error) {
                console.error('Error:', error);
                tbody.innerHTML = `<tr><td colspan="7" style="text-align:center; color:red;">Error: ${error.message}</td></tr>`;
                Swal.fire('Error', 'No se pudieron cargar los datos', 'error');
            }
        }

        // Renderizar Tabla
        function renderTable(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;">No hay registros.</td></tr>';
                return;
            }

            data.forEach(item => {
                const tr = document.createElement('tr');
                
                let statusClass = 'status-stock';
                if(item.status === 'Asignado') statusClass = 'status-asignado';
                if(item.status === 'Mantenimiento') statusClass = 'status-mantenimiento';
                if(item.status === 'Baja') statusClass = 'status-baja';

                tr.innerHTML = `
                    <td><i class="fa-solid fa-${getIconByType(item.type)}"></i> ${item.type}</td>
                    <td>${item.brand} ${item.model}</td>
                    <td>${item.serial}</td>
                    <td><span class="status-badge ${statusClass}">${item.status}</span></td>
                    <td>${item.assigned_to || '-'}</td>
                    <td>${item.location || '-'}</td>
                    <td>
                        <button class="btn-icon btn-edit" onclick="editItem('${item.id}')"><i class="fa-solid fa-pen"></i></button>
                        <button class="btn-icon btn-delete" onclick="deleteItem('${item.id}')"><i class="fa-solid fa-trash"></i></button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function getIconByType(type) {
            if(!type) return 'box';
            switch(type.toLowerCase()) {
                case 'laptop': return 'laptop';
                case 'celular': return 'mobile-screen';
                case 'pos': return 'cash-register';
                case 'desktop': return 'desktop';
                case 'monitor': return 'tv';
                case 'impresora': return 'print';
                default: return 'box';
            }
        }

        function updateKPIs(data) {
            const total = data.length;
            const stock = data.filter(i => i.status === 'Stock').length;
            const assigned = data.filter(i => i.status === 'Asignado').length;
            const maintenance = data.filter(i => i.status === 'Mantenimiento').length;

            document.getElementById('kpi-total').innerText = total;
            document.getElementById('kpi-stock').innerText = stock;
            document.getElementById('kpi-assigned').innerText = assigned;
            document.getElementById('kpi-maintenance').innerText = maintenance;
        }

        // --- 4. MODALES & FORMULARIOS ---
        const modalOverlay = document.getElementById('itemModal');
        const form = document.getElementById('inventoryForm');
        const statusSelect = document.getElementById('itemStatus');
        const assignmentFields = document.getElementById('assignmentFields');

        if(statusSelect) {
            statusSelect.addEventListener('change', (e) => {
                if (e.target.value === 'Asignado') {
                    assignmentFields.style.display = 'block';
                } else {
                    assignmentFields.style.display = 'none';
                    document.getElementById('assignedTo').value = '';
                    document.getElementById('location').value = '';
                }
            });
        }

        // Funciones Globales (Window)
        window.openModal = function() {
            if(form) form.reset();
            document.getElementById('itemId').value = '';
            document.getElementById('modalTitle').innerText = 'Nuevo Equipo';
            if(assignmentFields) assignmentFields.style.display = 'none';
            modalOverlay.style.display = 'flex';
        }

        window.closeModal = function() {
            modalOverlay.style.display = 'none';
        }

        window.editItem = function(id) {
            const item = inventoryData.find(i => String(i.id) === String(id));
            if(item) {
                document.getElementById('itemId').value = item.id;
                document.getElementById('itemType').value = item.type;
                document.getElementById('itemBrand').value = item.brand;
                document.getElementById('itemModel').value = item.model;
                document.getElementById('itemSerial').value = item.serial;
                document.getElementById('itemStatus').value = item.status;
                
                if(item.status === 'Asignado') {
                    assignmentFields.style.display = 'block';
                    document.getElementById('assignedTo').value = item.assigned_to;
                    document.getElementById('location').value = item.location;
                } else {
                    assignmentFields.style.display = 'none';
                }

                document.getElementById('modalTitle').innerText = 'Editar Equipo';
                modalOverlay.style.display = 'flex';
            }
        }

        window.toggleFilters = function() {
            Swal.fire('Info', 'Filtros avanzados en construcción.', 'info');
        }

        // Guardar
        if(form) {
            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = {
                    type: document.getElementById('itemType').value,
                    brand: document.getElementById('itemBrand').value,
                    model: document.getElementById('itemModel').value,
                    serial: document.getElementById('itemSerial').value,
                    status: document.getElementById('itemStatus').value,
                    assigned_to: document.getElementById('assignedTo').value || null,
                    location: document.getElementById('location').value || null
                };
                const itemId = document.getElementById('itemId').value;

                try {
                    if(!isDemoMode && supabase) {
                        let result;
                        if (itemId) {
                            result = await supabase.from('inventory').update(formData).eq('id', itemId);
                        } else {
                            result = await supabase.from('inventory').insert([formData]);
                        }
                        if (result.error) throw result.error;
                        
                        Swal.fire('Éxito', 'Registro guardado.', 'success');
                        closeModal();
                        fetchInventory();
                    } else {
                        Swal.fire('Modo Demo', 'Datos simulados guardados (no persistentes).', 'success');
                        closeModal();
                    }
                } catch (err) {
                    Swal.fire('Error', err.message, 'error');
                }
            });
        }

        window.deleteItem = function(id) {
            Swal.fire({
                title: '¿Estás seguro?',
                text: "No podrás revertir esta acción",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#e31837',
                cancelButtonColor: '#3085d6',
                confirmButtonText: 'Sí, borrar'
            }).then(async (result) => {
                if (result.isConfirmed) {
                    if(!isDemoMode && supabase) {
                        const { error } = await supabase.from('inventory').delete().eq('id', id);
                        if(error) {
                            Swal.fire('Error', error.message, 'error');
                        } else {
                            Swal.fire('Borrado', 'Registro eliminado.', 'success');
                            fetchInventory();
                        }
                    } else {
                        Swal.fire('Borrado (Demo)', 'Registro simulado eliminado.', 'success');
                    }
                }
            });
        }

        // Buscador
        const searchInput = document.getElementById('searchInput');
        if(searchInput) {
            searchInput.addEventListener('keyup', (e) => {
                const term = e.target.value.toLowerCase();
                const filtered = inventoryData.filter(item => 
                    (item.serial && item.serial.toLowerCase().includes(term)) ||
                    (item.model && item.model.toLowerCase().includes(term)) ||
                    (item.assigned_to && item.assigned_to.toLowerCase().includes(term))
                );
                renderTable(filtered);
            });
        }

        window.exportToExcel = function() {
            if(typeof XLSX === 'undefined') {
                Swal.fire('Error', 'Librería SheetJS no cargada.', 'error');
                return;
            }
            const ws = XLSX.utils.json_to_sheet(inventoryData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Inventario");
            XLSX.writeFile(wb, "Inventario_Dominos.xlsx");
        }

        window.logout = function() {
            if(!isDemoMode && supabase) supabase.auth.signOut();
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>