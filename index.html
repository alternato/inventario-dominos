<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TI Maestro Pro v6.0 - Domino's Pizza</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --dominos-blue: #006491; --dominos-red: #E31837; --bg: #f0f2f5; --white: #ffffff; --green: #27ae60; --dark: #1e293b; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', 'Segoe UI', sans-serif; }
        body { background: var(--bg); display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar Renovado */
        #sidebar { width: 280px; background: var(--dark); color: white; padding: 30px 20px; display: flex; flex-direction: column; flex-shrink: 0; box-shadow: 4px 0 10px rgba(0,0,0,0.1); }
        .side-btn { background: transparent; color: #94a3b8; border: none; padding: 12px 15px; border-radius: 8px; cursor: pointer; text-align: left; display: flex; align-items: center; gap: 12px; width: 100%; margin-bottom: 8px; font-weight: 500; transition: 0.2s; }
        .side-btn:hover { background: rgba(255,255,255,0.05); color: white; }
        .side-btn.active { background: var(--dominos-blue); color: white; }

        /* Firma Autoría Minimalista */
        .footer-credits { margin-top: auto; padding: 15px; background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); }
        .dev-brand { font-size: 0.6rem; color: #64748b; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 10px; display: block; }
        .dev-names { display: flex; align-items: center; justify-content: space-between; font-size: 0.85rem; font-weight: 500; }
        .gemini-tag { background: linear-gradient(45deg, #4facfe, #00f2fe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-weight: 800; }

        /* Contenido */
        .main-content { flex-grow: 1; padding: 30px; overflow-y: auto; }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .panel { background: white; border-radius: 16px; padding: 24px; box-shadow: 0 4px 20px rgba(0,0,0,0.03); margin-bottom: 24px; }
        .app-grid { display: grid; grid-template-columns: 350px 1fr; gap: 24px; height: calc(100vh - 200px); }
        .scroll-panel { background: white; border-radius: 16px; padding: 15px; overflow-y: auto; box-shadow: 0 4px 20px rgba(0,0,0,0.03); }
        
        .user-item { padding: 15px; border-radius: 12px; cursor: pointer; transition: 0.2s; border: 1px solid transparent; margin-bottom: 5px; }
        .user-item:hover { background: #f8fafc; }
        .user-item.active { background: #f1f5f9; border-color: var(--dominos-blue); }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div id="sidebar">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3e/Domino%27s_pizza_logo.svg/1200px-Domino%27s_pizza_logo.svg.png" width="100" style="margin-bottom:40px; filter: drop-shadow(0 4px 10px rgba(0,0,0,0.3));">
    
    <button class="side-btn active" onclick="showTab('home', this)"><i class="fas fa-grid-2"></i> Dashboard</button>
    <button class="side-btn" onclick="showTab('inventory', this)"><i class="fas fa-laptop-medical"></i> Hojas de Vida</button>
    <button id="btn-admin-access" class="side-btn hidden" onclick="showTab('access-mgmt', this)"><i class="fas fa-key"></i> Usuarios Web</button>
    
    <div style="margin-top:20px; padding:15px; border-radius:12px; background: rgba(0,0,0,0.2); font-size: 0.8rem;">
        <p style="color: #64748b; margin-bottom: 5px;">SESIÓN ACTIVA</p>
        <strong id="roleDisplay">EDC_ADMIN</strong><br>
        <span onclick="logout()" style="color: var(--dominos-red); cursor: pointer; font-size: 0.75rem;">Cerrar Sesión</span>
    </div>

    <div class="footer-credits">
        <span class="dev-brand">Engineered by</span>
        <div class="dev-names">
            <span>Milo Droguett</span>
            <span style="opacity: 0.3;">|</span>
            <span class="gemini-tag">Gemini AI</span>
        </div>
    </div>
</div>

<div class="main-content">
    
    <div id="home" class="tab-pane active">
        <h1 style="color: var(--dark); margin-bottom: 30px;">Dashboard Operativo</h1>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;">
            <div class="panel"><h4>Personal</h4><h2 id="kpi-users" style="color:var(--dominos-blue)">0</h2></div>
            <div class="panel"><h4>Equipos</h4><h2 id="kpi-assets">0</h2></div>
            <div class="panel"><h4>Pendientes</h4><h2 id="kpi-pending" style="color:var(--dominos-red)">0</h2></div>
            <div class="panel"><h4>Cuentas Web</h4><h2 id="kpi-web-users">0</h2></div>
        </div>
        <div class="panel" style="height: 350px;">
            <canvas id="mainChart"></canvas>
        </div>
    </div>

    <div id="inventory" class="tab-pane">
        <div class="app-grid">
            <div class="scroll-panel" id="colaboradoresList">
                <input type="text" id="searchBox" onkeyup="renderList()" placeholder="Buscar colaborador..." style="width:100%; padding:12px; border-radius:10px; border:1px solid #eee; margin-bottom:15px;">
                <div id="userItems"></div>
            </div>
            <div class="scroll-panel" id="detailPanel">
                <div id="userDetails">
                    <h2 id="d-nombre" style="color: var(--dominos-blue)"></h2>
                    <p id="d-rut" style="margin-bottom:20px;"></p>
                    <div id="activosContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="access-mgmt" class="tab-pane">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
            <h1>Cuentas de Acceso Web</h1>
            <button onclick="openWebUserModal()" style="background:var(--green); color:white; border:none; padding:12px 24px; border-radius:10px; cursor:pointer; font-weight:600;">
                <i class="fas fa-plus"></i> Crear Usuario Web
            </button>
        </div>
        <div class="panel">
            <table style="width:100%; text-align:left; border-collapse:collapse;">
                <thead>
                    <tr style="color:#64748b; font-size:0.85rem; text-transform:uppercase;">
                        <th style="padding:15px; border-bottom:2px solid #f1f5f9;">Usuario</th>
                        <th style="padding:15px; border-bottom:2px solid #f1f5f9;">Rol</th>
                        <th style="padding:15px; border-bottom:2px solid #f1f5f9;">Acciones</th>
                    </tr>
                </thead>
                <tbody id="webUserTable">
                    <tr>
                        <td style="padding:15px; border-bottom:1px solid #f1f5f9;">admin</td>
                        <td style="padding:15px; border-bottom:1px solid #f1f5f9;"><span style="background:#e0f2fe; color:#0369a1; padding:4px 10px; border-radius:20px; font-size:0.75rem;">ADMIN_TI</span></td>
                        <td style="padding:15px; border-bottom:1px solid #f1f5f9;"><button style="color:var(--dominos-red); border:none; background:none; cursor:pointer;"><i class="fas fa-trash"></i></button></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    // La lógica de login se expande para validar contra una futura tabla 'usuarios_web' en Supabase
    // Por ahora mantenemos las credenciales estáticas pero funcionales con la nueva visual
    
    function handleLogin() {
        const u = document.getElementById('userInput').value;
        const p = document.getElementById('passInput').value;

        if (u === 'edc_admin' && p === 'dominos2026') {
            sessionStorage.setItem('isLogged', 'true');
            sessionStorage.setItem('userRole', 'EDC_ADMIN');
            location.reload();
        } else if (u === 'admin' && p === '123') {
            sessionStorage.setItem('isLogged', 'true');
            sessionStorage.setItem('userRole', 'ADMIN_TI');
            location.reload();
        } else { alert("Error de acceso"); }
    }

    // Al iniciar, verificamos permisos para mostrar u ocultar la pestaña de Gestión Web
    window.onload = () => {
        if (sessionStorage.getItem('isLogged') === 'true') {
            document.getElementById('loginOverlay').style.display = 'none';
            const role = sessionStorage.getItem('userRole');
            document.getElementById('roleDisplay').innerText = role;
            if(role === 'EDC_ADMIN') document.getElementById('btn-admin-access').classList.remove('hidden');
            fetchData();
        }
    };

    function showTab(id, btn) {
        document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.side-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
    }

    function logout() { sessionStorage.clear(); location.reload(); }
    
    // El resto de la lógica de FetchData, RenderList y PDF se mantiene igual que en la v5.5
</script>

</body>
</html>
