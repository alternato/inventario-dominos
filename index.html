<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TI Maestro v64.6 - Domino's Pizza Chile</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #0066CC; --secondary: #E31837; --success: #22c55e;
            --bg: #f8fafc; --border: #e2e8f0; --dark: #0f172a;
            --sidebar-w: 260px; --radius: 12px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); height: 100vh; overflow: hidden; font-size: 13px; }
        
        #sidebar { width: var(--sidebar-w); background: linear-gradient(180deg, var(--primary) 0%, #0052a3 100%); color: white; padding: 25px; display: flex; flex-direction: column; flex-shrink: 0; }
        
        /* Contenedor de Logo */
        .logo-box { text-align: center; margin-bottom: 30px; display: flex; justify-content: center; }
        .dominos-svg { width: 100px; height: auto; }
        .dominos-svg path { fill: white; } /* Fuerza el logo a ser blanco */

        .nav-btn { background: rgba(255,255,255,0.1); color: white; border: none; padding: 12px 15px; border-radius: 8px; width: 100%; margin-bottom: 8px; text-align: left; cursor: pointer; display: flex; align-items: center; gap: 12px; transition: 0.2s; }
        .nav-btn.active { background: var(--secondary); font-weight: 700; }

        .main-container { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; }
        header { background: white; padding: 18px 25px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .content-area { padding: 25px; overflow-y: auto; flex-grow: 1; }

        .table-container { background: white; border-radius: var(--radius); border: 1px solid var(--border); overflow: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 1800px; }
        th { background: #f1f5f9; padding: 12px; text-align: left; position: sticky; top: 0; z-index: 10; font-size: 11px; text-transform: uppercase; color: #475569; }
        td { padding: 10px 12px; border-bottom: 1px solid #f1f5f9; }

        .modal { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; padding: 30px; border-radius: 20px; width: 95%; max-width: 1100px; max-height: 90vh; overflow-y: auto; }
        
        .section-tag { grid-column: span 4; color: var(--primary); font-weight: 800; border-bottom: 2px solid #eee; padding-bottom: 5px; text-transform: uppercase; margin: 15px 0 10px 0; font-size: 11px; }
        .form-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .field { display: flex; flex-direction: column; gap: 4px; }
        .field label { font-size: 11px; font-weight: 700; color: #64748b; }
        input, select, textarea { padding: 8px; border: 1.5px solid var(--border); border-radius: 6px; outline: none; font-size: 12px; }

        .switch-box { display: flex; align-items: center; gap: 10px; background: #f8fafc; padding: 10px; border-radius: 8px; border: 1px solid var(--border); }
        .toggle { position: relative; display: inline-block; width: 40px; height: 20px; }
        .toggle input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; inset: 0; background-color: #cbd5e1; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--success); }
        input:checked + .slider:before { transform: translateX(20px); }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<svg style="display:none">
    <symbol id="logo-dominos" viewBox="0 0 100 100">
        <path d="M50 5L15 40L50 75L85 40L50 5ZM35 40C32.2 40 30 37.8 30 35C30 32.2 32.2 30 35 30C37.8 30 40 32.2 40 35C40 37.8 37.8 40 35 40ZM65 40C62.2 40 60 37.8 60 35C60 32.2 62.2 30 65 30C67.8 30 70 32.2 70 35C70 37.8 67.8 40 65 40ZM50 65C47.2 65 45 62.8 45 60C45 57.2 47.2 55 50 55C52.8 55 55 57.2 55 60C55 62.8 52.8 65 50 65Z"/>
    </symbol>
</svg>

<div id="loginPage" class="modal" style="background: var(--primary);">
    <div class="modal-content" style="max-width: 350px; text-align: center;">
        <svg class="dominos-svg" style="width: 80px; fill: var(--primary); margin-bottom: 20px;"><use xlink:href="#logo-dominos"></use></svg>
        <h3>TI Maestro v64.6</h3>
        <input type="password" id="passInput" placeholder="Clave: DominoTI2026" style="text-align: center; margin: 20px 0; width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px;">
        <button onclick="intentarLogin()" class="nav-btn" style="background: var(--secondary); justify-content: center; font-weight: 700;">ACCEDER</button>
    </div>
</div>

<div id="app" class="hidden" style="display: flex; width: 100%; height: 100vh;">
    <aside id="sidebar">
        <div class="logo-box">
            <svg class="dominos-svg"><use xlink:href="#logo-dominos"></use></svg>
        </div>
        <button class="nav-btn active" id="btn-inv" onclick="showView('inventory')"><i class="fas fa-boxes"></i> Inventario Maestro</button>
        <button class="nav-btn" onclick="showView('metrics')"><i class="fas fa-chart-line"></i> Reportes</button>
        <hr style="margin: 20px 0; opacity: 0.2;">
        <button class="nav-btn" style="background: var(--success);" onclick="abrirFicha()"><i class="fas fa-plus-circle"></i> NUEVO REGISTRO</button>
    </aside>

    <main class="main-container">
        <header>
            <h2 id="viewTitle">Inventario Maestro TI</h2>
            <div style="font-size: 11px; color: #22c55e; font-weight: 700;"><i class="fas fa-database"></i> BASE SINCRONIZADA</div>
        </header>

        <div class="content-area">
            <div id="view-inventory">
                <input type="text" id="mainSearch" placeholder="Buscar por RUT, Persona o Serie..." style="width: 100%; margin-bottom: 15px; padding: 10px; border-radius: 8px; border: 1px solid var(--border);" oninput="renderMasterTable()">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>RUT</th><th>Persona</th><th>Fecha Entrega</th><th>Estado</th><th>Correo</th><th>Área</th><th>Ubicación</th>
                                <th>Marca</th><th>Modelo</th><th>Nº de Serie</th><th>Doc. Firmado</th><th>Mochila</th><th>Cargador</th>
                                <th>IT Entregó</th><th>Devolución</th><th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="masterTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>
</div>

<div id="modalFicha" class="modal hidden">
    <div class="modal-content">
        <h2 style="margin-bottom: 15px; color: var(--primary); font-size: 18px;"><i class="fas fa-file-signature"></i> Ficha Técnica Relacional</h2>
        <div class="form-grid">
            <div class="section-tag">1. Datos del Colaborador</div>
            <div class="field"><label>RUT *</label><input type="text" id="f_rut" oninput="validarYFormatearRUT(this)" placeholder="11.222.333-4"></div>
            <div class="field" style="grid-column: span 2;"><label>Nombre Completo *</label><input type="text" id="f_nombre" onblur="sugerirCorreo(this.value)"></div>
            <div class="field"><label>Correo Corporativo</label><input type="email" id="f_correo"></div>
            
            <div class="field"><label>Área</label><select id="f_area">
                <option>Operaciones</option><option>Informática</option><option>Administración</option><option>Marketing</option><option>Logística</option><option>Finanzas</option><option>RRHH</option>
            </select></div>
            <div class="field"><label>Ubicación (Tienda)</label><select id="f_tienda"></select></div>
            <div class="field"><label>Estado</label><select id="f_estado"><option>Asignado</option><option>Disponible</option><option>Mantención</option></select></div>
            <div class="field"><label>Doc. Firmado</label><select id="f_doc"><option>No</option><option>Si</option></select></div>

            <div class="section-tag">2. Datos del Equipo</div>
            <div class="field"><label>Marca</label><input type="text" id="f_marca"></div>
            <div class="field"><label>Modelo</label><input type="text" id="f_modelo"></div>
            <div class="field"><label>Serie *</label><input type="text" id="f_serie"></div>
