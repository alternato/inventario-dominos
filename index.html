<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acceso - TI Maestro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root { --primary: #0066CC; --secondary: #E31837; --bg: #0066CC; }
        body { 
            margin: 0; font-family: 'Inter', sans-serif; height: 100vh; 
            background: linear-gradient(135deg, #0052a3 0%, #0066CC 100%);
            display: flex; align-items: center; justify-content: center;
        }
        .login-card { 
            background: white; padding: 40px; border-radius: 20px; width: 100%; max-width: 380px; 
            text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); 
        }
        .logo-img { width: 140px; margin-bottom: 30px; }
        .btn { 
            width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; 
            font-weight: 700; display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 10px;
        }
        .btn-ms { background: #2f2f2f; color: white; border: 1px solid #444; font-size: 14px;}
        .btn-manual { background: var(--secondary); color: white; margin-top: 10px;}
        .divider { display: flex; align-items: center; margin: 20px 0; opacity: 0.5; font-size: 10px; font-weight: bold; }
        .divider hr { flex-grow: 1; border: 0; border-top: 1px solid #ccc; }
        .divider span { padding: 0 10px; color: #666; }
        input { 
            width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; 
            box-sizing: border-box; text-align: center; font-size: 14px;
        }
        #loading { display: none; color: #666; font-size: 12px; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="login-card">
        <img src="https://logos-world.net/wp-content/uploads/2021/08/Dominos-Logo.png" class="logo-img">
        
        <button onclick="signInWithMicrosoft()" class="btn btn-ms">
            <i class="fab fa-microsoft"></i> Ingresar con Domino's
        </button>

        <div id="loading">Conectando...</div>

        <div class="divider">
            <hr><span>ACCESO DE RESPALDO</span><hr>
        </div>

        <input type="password" id="passInput" placeholder="Clave de Respaldo Local">
        <button onclick="intentarLoginManual()" class="btn btn-manual">ACCEDER MANUALMENTE</button>
    </div>

    <script>
        // --- CONFIGURACIÓN ---
        const SB_URL = 'https://ivjwxvhixrskraepqzse.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml2and4dmhpeHJza3JhZXBxenNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5MjgxNTgsImV4cCI6MjA4NDUwNDE1OH0.QzgNSwqf6VTXZjGMXOAfUnjW4f1mJcRqECxxNnLZc-o';
        const sb = supabase.createClient(SB_URL, SB_KEY);

        // 1. Verificar si ya entró
        window.onload = async () => {
            const { data: { session } } = await sb.auth.getSession();
            if (session) window.location.href = 'dashboard.html';
        };

        // 2. Login Microsoft
        async function signInWithMicrosoft() {
            document.getElementById('loading').style.display = 'block';
            await sb.auth.signInWithOAuth({
                provider: 'azure',
                options: {
                    scopes: 'email',
                    queryParams: { prompt: 'select_account' },
                    // IMPORTANTE: Apuntar al archivo dashboard.html
                    redirectTo: 'https://alternato.github.io/inventario-dominos/dashboard.html'
                }
            });
        }

        // 3. Login Manual (Respaldo)
        function intentarLoginManual() {
            const pass = document.getElementById('passInput').value;
            if(pass === "DominoTI2026") {
                // Guardamos una "marca" temporal para saber que es admin local
                localStorage.setItem('local_admin', 'true');
                window.location.href = 'dashboard.html';
            } else {
                alert("Clave incorrecta");
            }
        }
    </script>
</body>
</html>
